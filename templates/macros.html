{% macro xheaderrow(name, index=None) %}
<tr>
<td>PayPeriod</td>
<td>Start</td>
<td>{{period.startDate().date()}}</td>
<td>End</td>
<td>{{period.endDate().date()}}</td>
<td></td>
</tr>
<tr><td>Employee</td><td colspan=5>{{nanny}}</td></tr>
<tr><td>Child Care For</td><td colspan=5>{{name}}</td></tr>
</tr>
<tr class='employer'>
<td>Employer</td>
<td colspan=5>{{sconfig['employer{}'.format(index)]|replace('\n','<br/>')|safe}}</td>
</tr>
{% endmacro %}


{% macro headerrow(name, index=None) %}
<tr class='header'><td colspan=6>

<div class='float'>
<div><span class='header'>PayPeriod</span></div>
<div><span class='value'>{{period.startDate().date()}}</span></div>
<div><span class='value'>{{period.endDate().date()}}</span></div>
</div>

<div class='float'>
<div><span class='header'>Employee</span></div>
<div><span class='value'>{{nanny}}</span></div>
</div>

<div class='float'>
<div><span class='header'>Childcare For</span></div>
<div><span class='value'>{{name}}</span></div>
</div>

<div class='float'>
{% if index %}
<div><span class='header'>Employer</span></div>
<div><span class='value'>{{sconfig['employer{}'.format(index)]|replace('\n','<br/>')|safe}}</span></div>
{% else %}
<div><span class='header'>Combined</span></div>
{% endif %}
</div>
</td>

</tr>

<tr class='divider'><td colspan=6></tr>
<tr class='info'>
<th colspan=3></th>
<th>Period</th>
<th></th>
<th>YTD</th>
</tr>
{% endmacro %}


{% macro taxrow(title, rate, prefix, key) -%}
<tr>
<td>{{title}}</td>
<td>{{rate|dpercent}}</td>
<td></td>
<td>{{sums['tax'][prefix + key]|dollar}}</td>
<td></td>
<td>{{sums['tax'][prefix + key + ' YTD']|dollar}}</td>
</tr>
{% endmacro %}

{% macro taxsum(title, key, rowclass="") -%}
<tr class='{{rowclass}}'>
<td>{{title}}</td>
<td></td>
<td></td>
<td>{{sums['tax'][key]|dollar}}</td>
<td></td>
<td>{{sums['tax'][key+' YTD']|dollar}}</td>
</tr>
{% endmacro %}


{% macro sumrow(title, rate, key, rowclass="") -%}
<tr class='{{rowclass}}'> 
<td>{{title}}</td>
<td>{{rate|dollar}}</td>
<td>{{sums['hours'][key]|nozero}}</td>
<td>{{sums['sums'][key]|dollar}}</td>
<td>{{sums['hours'][key+' YTD']|nozero}}</td>
<td>{{sums['sums'][key+' YTD']|dollar}}</td>
</tr>
{% endmacro %}


{% macro halfsumrow(title, rate, key) -%}
<tr>
<td>{{title}}</td>
<td>{{rate|dollar}}</td>
<td>{{(sums['hours'][key]/2)|nozero}}</td>
<td>{{sums['sums'][key]|dollar}}</td>
<td>{{(sums['hours'][key+' YTD']/2)|nozero}}</td>
<td>{{sums['sums'][key+' YTD']|dollar}}</td>
</tr>
{% endmacro %}


{% macro netrow(key) -%}
<tr class='netpay'>
<td>Net Pay</td>
<td></td>
<td></td>
<td>{{nets[key]|dollar}}</td>
<td></td>
<td>{{nets[key+' YTD']|dollar}}</td>
</tr>
{% endmacro %}


{% macro hourstable() -%}
<table class='hours'>
<tr>
<th class='date'>Date</th>
{% for name in children %}
<th>{{name}}</th>
{% endfor %}
<th>Both</th>
{% for name in children %}
<th>{{name}} OT</th>
{% endfor %}
<th>Both OT</th>
<th>Sick</th>
<th>Holiday</th>
</tr>

{% for h in hours %}
<tr>
<td class='date'>{{h.date.date()}}</td>
{% for name in children %}
<td>{{h.data[name]|nozero}}</td>
{% endfor %}
<td>{{h.data['Both']|nozero}}</td>
{% for name in children %}
<td>{{h.data[name+' OT']|nozero}}</td>
{% endfor %}
<td>{{h.data['Both OT']|nozero}}</td>
<td>{{h.data['Sick']|nozero}}</td>
<td>{{h.data['Holiday']|nozero}}</td>
</tr>
{% endfor %}
<table>
{% endmacro %}

{% macro reimbursementtable() -%}
<table class='reimbursements'>
{% if reimb %}
<tr>
<th class='date'>Date</th>
<th>Amount</th>
<th>Notes</th>
</tr>

{% for r in reimb %}
<tr>
<td style='width:15%'>{{r.date.date()}}</td>
<td style='width:15%'>{{r.amount|dollar}}</td>
<td style='width:70%'>{{r.notes}}</td>
</tr>
{% endfor %}
{% endif %}
<table>
{% endmacro %}


{% macro singletable(name, index) -%}
<table class='paystub'>
{{headerrow(name, index)}}
{{sumrow(    'One-Child',               rates[0],           name)}}
{{halfsumrow('Two-Child Half',          rates[1],           name+' Both')}}
{{sumrow(    'Overtime One-Child',      rates[2],           name+' OT')}}
{{halfsumrow('Overtime Two-Child Half', rates[3],           name+' Both OT')}}
{{halfsumrow('Sick Half',               rates[0:2]|reverse, name+' Sick')}}
{{halfsumrow('Holiday Half',            rates[0:2]|reverse, name+' Holiday')}}
{{sumrow(    '',                        '',                 name+' Gross', 'summation')}}
{{taxrow('Federal Witholding',        '',                        name+' ', 'Fed')}}
{{taxrow('Medicare',                  sconfig.medicare/2,        name+' ', 'Medicare1')}}
{{taxrow('Social Security',           sconfig.social_security/2, name+' ', 'SS1')}}
{{taxrow('WA Medical & Family Leave', sconfig.family_leave,      name+' ', 'WALeave')}}
{{taxsum('Employee Taxes',                                       name+' EmployeeTax', 'summation')}}
{{sumrow('Reimbursements Half', '', name+' Reimbursements')}}
{{netrow(name)}}
{{taxrow('Federal Unemployment', sconfig.fed_unemployment,  name+' ', 'FedUnemp')}}
{{taxrow('Medicare',             sconfig.medicare/2,        name+' ', 'Medicare2')}}
{{taxrow('Social Security',      sconfig.social_security/2, name+' ', 'SS2')}}
{{taxrow('WA Unemployment',      sconfig.wa_unemployment,   name+' ', 'WAUnemp')}}
{{taxsum('Employer Taxes',                                  name+' EmployerTax', 'summation')}}
</table>
{% endmacro %}
